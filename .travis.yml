language: node_js

dist: trusty

sudo: required

node_js:
  - "8"
jdk:
  - oraclejdk8
  
addons:
    apt:
      packages:
        - oracle-java8-installer 
    sonarcloud:
        organization: "brennomilanezi-github"
        token:
            secure: f38656ed88d5a061447dbe17101fcab4503ea1b3

before_script:
  - export JAVA_HOME=/usr/lib/jvm/java-8-oracle
  
branches:
  only:
  - master
  - dev
  
install:
  - npm install
  - npm install typescript
  
deploy:
provider: heroku
  api-key: 
    secure: c4db4f55-65b3-450d-803d-dee8df340a10
  app: meu-pedido-ts
    
notifications:
  slack: bsi-ifserra:6akoTA2ECkSegyCvpmPaN0WO

before_install:
  - sudo apt-get install -y jq
  
install:
  - npm install
  - npm install typescript
   
script:
  - npm build 
  - sonar-scanner > sonar.txt
  - sh breakingbuildsonar.sh sonar.txt f38656ed88d5a061447dbe17101fcab4503ea1b3 https://sonarcloud.io
  - rm sonar.txt
  
deploy:
  provider: heroku
  api_key:
    secure: c4db4f55-65b3-450d-803d-dee8df340a10
    
notifications:
  slack: bsi-ifserra:6akoTA2ECkSegyCvpmPaN0WO
    
cache:
  directories:
    - node_modules